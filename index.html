<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Aqu√≠ sigo</title>
    <style>
        :root {
            --color1: #000000;
            --color2: #02457A;
            --color3: #018ABE;
            --color4: #97CADB;
            --color5: #D6E8EE;
            --rojo1: #8B0000;
            --rojo2: #B22222;
            --rojo3: #DC143C;
            --dorado1: #D4AF37;
            --dorado2: #FFD700;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #000000;
            color: var(--color5);
            min-height: 100vh;
            line-height: 1.5;
            overflow-x: hidden;
            position: relative;
            -webkit-font-smoothing: antialiased;
            touch-action: manipulation;
        }
        
        /* PANTALLA DE CARGA CON CRON√ìMETRO REGRESIVO Y PASSWORD */
        #loadingScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--color1) 0%, var(--color2) 100%);
            z-index: 4000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
            overflow-y: auto;
        }
        
        .loading-content {
            max-width: 600px;
            width: 100%;
        }
        
        .loading-title {
            font-size: 2rem;
            color: var(--dorado2);
            margin-bottom: 20px;
            text-shadow: 0 2px 10px rgba(212, 175, 55, 0.5);
            font-weight: 300;
        }
        
        .loading-subtitle {
            font-size: 1.2rem;
            color: var(--color4);
            margin-bottom: 40px;
            opacity: 0.9;
        }
        
        .countdown-container {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            border: 2px solid var(--dorado1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        .countdown-title {
            font-size: 1.3rem;
            color: var(--color5);
            margin-bottom: 25px;
            font-weight: 500;
        }
        
        .countdown-display {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .countdown-unit {
            background: rgba(1, 138, 190, 0.2);
            border-radius: 15px;
            padding: 15px 10px;
            min-width: 100px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(1, 138, 190, 0.3);
        }
        
        .countdown-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--dorado2);
            line-height: 1;
            margin-bottom: 5px;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }
        
        .countdown-label {
            font-size: 0.9rem;
            color: var(--color4);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .countdown-separator {
            display: flex;
            align-items: center;
            color: var(--color3);
            font-size: 2rem;
            font-weight: bold;
        }
        
        .date-display {
            margin-top: 30px;
            font-size: 1.1rem;
            color: var(--color5);
            background: rgba(2, 69, 122, 0.3);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid var(--dorado1);
        }
        
        .date-display span {
            color: var(--dorado2);
            font-weight: 600;
        }
        
        /* SECCI√ìN DE CLAVE DE ACCESO */
        .password-section {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 20px;
            padding: 25px;
            margin: 20px 0 30px;
            border: 1px solid var(--color3);
            backdrop-filter: blur(5px);
        }
        
        .password-title {
            font-size: 1.3rem;
            color: var(--color5);
            margin-bottom: 20px;
            font-weight: 400;
        }
        
        .password-input-group {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .password-input {
            background: rgba(255,255,255,0.1);
            border: 2px solid var(--color3);
            border-radius: 50px;
            padding: 15px 25px;
            font-size: 1.2rem;
            color: white;
            text-align: center;
            width: 150px;
            outline: none;
            font-family: monospace;
            letter-spacing: 4px;
        }
        
        .password-input:focus {
            border-color: var(--dorado2);
            box-shadow: 0 0 15px rgba(255,215,0,0.3);
        }
        
        .password-button {
            background: var(--color3);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 15px 35px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .password-button:active {
            transform: scale(0.95);
            background: var(--color2);
        }
        
        .password-button:hover {
            border-color: var(--dorado2);
        }
        
        .password-error {
            color: #ff6b6b;
            margin-top: 15px;
            font-size: 1rem;
            min-height: 24px;
            font-weight: 500;
        }
        
        /* Animaci√≥n de im√°genes a pantalla completa */
        #fullscreenAnimation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 3000;
            display: none;
            justify-content: center;
            align-items: center;
        }
        
        .animation-image {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0;
            animation: imageSequence 12s ease-in-out infinite;
        }
        
        .animation-image:nth-child(1) {
            animation-delay: 0s;
        }
        
        .animation-image:nth-child(2) {
            animation-delay: 4s;
        }
        
        .animation-image:nth-child(3) {
            animation-delay: 8s;
        }
        
        @keyframes imageSequence {
            0% {
                opacity: 0;
                transform: scale(1);
            }
            10% {
                opacity: 1;
                transform: scale(1.05);
            }
            30% {
                opacity: 1;
                transform: scale(1);
            }
            40% {
                opacity: 0;
                transform: scale(1);
            }
            100% {
                opacity: 0;
            }
        }
        
        /* Contenedor principal */
        .main-container {
            display: none;
            max-width: 100%;
            margin: 0 auto;
            padding: 20px 15px;
            animation: fadeIn 1s ease;
        }
        
        /* Cron√≥metro de tiempo transcurrido */
        .time-counter {
            background: linear-gradient(135deg, rgba(2, 69, 122, 0.8) 0%, rgba(1, 138, 190, 0.8) 100%);
            border-radius: 20px;
            padding: 25px;
            margin: 30px 0;
            text-align: center;
            border: 1px solid rgba(151, 202, 219, 0.3);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
        
        .time-counter-title {
            font-size: 1.4rem;
            color: var(--dorado2);
            margin-bottom: 20px;
            font-weight: 500;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        
        .time-counter-display {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .time-unit {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 12px;
            padding: 15px 10px;
            min-width: 80px;
            border: 1px solid rgba(151, 202, 219, 0.2);
        }
        
        .time-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: white;
            line-height: 1;
            margin-bottom: 5px;
        }
        
        .time-label {
            font-size: 0.8rem;
            color: var(--color4);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .time-start-date {
            font-size: 1rem;
            color: var(--color5);
            opacity: 0.9;
            margin-top: 10px;
        }
        
        .time-start-date span {
            color: var(--dorado2);
            font-weight: 500;
        }
        
        /* Mensaje √∫nico central */
        .message-container {
            text-align: center;
            margin: 40px 0 30px;
            padding: 0 15px;
        }
        
        #unicoMensaje {
            font-size: 2.2rem;
            font-weight: 300;
            color: var(--color5);
            line-height: 1.4;
            margin: 0;
            text-shadow: 0 2px 15px rgba(0, 0, 0, 0.7);
            letter-spacing: -0.5px;
        }
        
        /* Galer√≠a m√≥vil */
        .gallery {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 30px 0;
        }
        
        .photo-frame {
            position: relative;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            transition: transform 0.3s ease;
            aspect-ratio: 1/1;
            background: #111;
            cursor: pointer;
        }
        
        .photo-frame:active {
            transform: scale(0.97);
        }
        
        .photo-frame img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* Fullscreen para im√°genes de galer√≠a */
        .image-fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.98);
            z-index: 2000;
            display: none;
            justify-content: center;
            align-items: center;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }
        
        .fullscreen-image {
            max-width: 100%;
            max-height: 90vh;
            object-fit: contain;
            border-radius: 10px;
        }
        
        .close-fullscreen {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            font-size: 28px;
            cursor: pointer;
            z-index: 2001;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Controles de audio */
        .audio-section {
            margin: 40px 0;
            text-align: center;
            display: none;
        }
        
        .audio-button {
            background: var(--color3);
            color: white;
            border: none;
            padding: 18px 35px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 12px;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(1, 138, 190, 0.3);
        }
        
        .audio-button:active {
            transform: scale(0.95);
            background: var(--color2);
        }
        
        .song-info {
            color: var(--color4);
            font-size: 0.9rem;
            margin-top: 15px;
            opacity: 0.8;
        }
        
        /* Footer */
        footer {
            margin-top: 60px;
            text-align: center;
            padding: 30px 0;
            border-top: 1px solid rgba(1, 138, 190, 0.2);
        }
        
        #firma {
            font-size: 1.1rem;
            color: var(--color3);
            font-style: italic;
            opacity: 0.9;
        }
        
        /* Estado de error de audio */
        .audio-error .song-info {
            color: #ff6b6b;
            font-weight: 500;
        }
        
        /* Animaciones */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .main-container {
                padding: 15px 12px;
            }
            
            #unicoMensaje {
                font-size: 1.8rem;
            }
            
            .message-container {
                margin: 30px 0 25px;
            }
            
            .gallery {
                gap: 12px;
                margin: 25px 0;
            }
            
            .audio-button {
                padding: 16px 30px;
                font-size: 1rem;
            }
            
            .audio-section {
                margin: 35px 0;
            }
            
            .loading-title {
                font-size: 1.6rem;
            }
            
            .countdown-unit {
                min-width: 80px;
                padding: 12px 8px;
            }
            
            .countdown-value {
                font-size: 2rem;
            }
            
            .time-counter {
                padding: 20px 15px;
            }
            
            .time-unit {
                min-width: 70px;
                padding: 12px 8px;
            }
            
            .time-value {
                font-size: 1.5rem;
            }
            
            .password-input {
                width: 130px;
                padding: 12px 20px;
                font-size: 1.1rem;
            }
            
            .password-button {
                padding: 12px 25px;
                font-size: 1.1rem;
            }
        }
        
        @media (max-width: 480px) {
            .gallery {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .photo-frame {
                aspect-ratio: 4/3;
            }
            
            #unicoMensaje {
                font-size: 1.6rem;
            }
            
            .message-container {
                margin: 25px 0 20px;
            }
            
            .loading-title {
                font-size: 1.4rem;
            }
            
            .countdown-display {
                gap: 8px;
            }
            
            .countdown-unit {
                min-width: 70px;
                padding: 10px 5px;
            }
            
            .countdown-value {
                font-size: 1.8rem;
            }
            
            .countdown-label {
                font-size: 0.8rem;
            }
            
            .time-counter-display {
                gap: 8px;
            }
            
            .time-unit {
                min-width: 60px;
                padding: 10px 5px;
            }
            
            .time-value {
                font-size: 1.3rem;
            }
            
            .time-label {
                font-size: 0.7rem;
            }
        }
        
        /* iPhone notch/padding seguro */
        @supports (padding: max(0px)) {
            .main-container {
                padding-left: max(15px, env(safe-area-inset-left));
                padding-right: max(15px, env(safe-area-inset-right));
                padding-bottom: max(30px, env(safe-area-inset-bottom));
            }
            
            #loadingScreen {
                padding-left: max(20px, env(safe-area-inset-left));
                padding-right: max(20px, env(safe-area-inset-right));
            }
        }
    </style>
</head>

<body>
    <!-- Pantalla de carga con cron√≥metro regresivo y clave (siempre visible hasta clave correcta) -->
    <div id="loadingScreen">
        <div class="loading-content">
            <h1 class="loading-title pulse">Aqu√≠ sigo</h1>
            <p class="loading-subtitle">Un espacio especial protegido</p>
            
            <div class="countdown-container">
                <div class="countdown-title">Tiempo restante para la fecha simb√≥lica:</div>
                <div class="countdown-display">
                    <div class="countdown-unit">
                        <div id="countdown-days" class="countdown-value">00</div>
                        <div class="countdown-label">D√≠as</div>
                    </div>
                    
                    <div class="countdown-separator">:</div>
                    
                    <div class="countdown-unit">
                        <div id="countdown-hours" class="countdown-value">00</div>
                        <div class="countdown-label">Horas</div>
                    </div>
                    
                    <div class="countdown-separator">:</div>
                    
                    <div class="countdown-unit">
                        <div id="countdown-minutes" class="countdown-value">00</div>
                        <div class="countdown-label">Minutos</div>
                    </div>
                    
                    <div class="countdown-separator">:</div>
                    
                    <div class="countdown-unit">
                        <div id="countdown-seconds" class="countdown-value">00</div>
                        <div class="countdown-label">Segundos</div>
                    </div>
                </div>
                
                <div class="date-display">
                    Fecha de disponibilidad p√∫blica: <span>14 de Febrero de 2026</span>
                </div>
            </div>
            
            <!-- SECCI√ìN DE CLAVE (obligatoria) -->
            <div class="password-section">
                <div class="password-title">üîê Ingresa la clave para acceder</div>
                <div class="password-input-group">
                    <input type="password" id="passwordInput" class="password-input" placeholder="Clave" maxlength="4" inputmode="numeric" pattern="\d*">
                    <button id="passwordButton" class="password-button">Acceder</button>
                </div>
                <div id="passwordError" class="password-error"></div>
            </div>
            
            <div class="date-display" style="margin-top: 10px; border-left-color: var(--rojo3);">
                Llevamos: <span id="elapsed-preview">Calculando...</span>
            </div>
        </div>
    </div>
    
    <!-- Animaci√≥n de im√°genes a pantalla completa -->
    <div id="fullscreenAnimation">
        <!-- Las im√°genes se insertar√°n aqu√≠ -->
    </div>
    
    <!-- Fullscreen para im√°genes de galer√≠a -->
    <div id="imageFullscreen" class="image-fullscreen">
        <button class="close-fullscreen" onclick="closeFullscreen()">√ó</button>
        <img id="fullscreenImg" class="fullscreen-image" src="" alt="">
    </div>
    
    <!-- Contenedor principal -->
    <div id="mainContainer" class="main-container">
        <!-- Cron√≥metro de tiempo transcurrido -->
        <div class="time-counter">
            <div class="time-counter-title">Tiempo transcurrido desde nuestro inicio</div>
            <div class="time-counter-display">
                <div class="time-unit">
                    <div id="elapsed-years" class="time-value">0</div>
                    <div class="time-label">A√±os</div>
                </div>
                
                <div class="time-unit">
                    <div id="elapsed-months" class="time-value">0</div>
                    <div class="time-label">Meses</div>
                </div>
                
                <div class="time-unit">
                    <div id="elapsed-days" class="time-value">0</div>
                    <div class="time-label">D√≠as</div>
                </div>
                
                <div class="time-unit">
                    <div id="elapsed-hours" class="time-value">0</div>
                    <div class="time-label">Horas</div>
                </div>
                
                <div class="time-unit">
                    <div id="elapsed-minutes" class="time-value">0</div>
                    <div class="time-label">Minutos</div>
                </div>
                
                <div class="time-unit">
                    <div id="elapsed-seconds" class="time-value">0</div>
                    <div class="time-label">Segundos</div>
                </div>
            </div>
            
            <div class="time-start-date">
                Inicio: <span>22 de Agosto de 2024, 8:00 PM</span>
            </div>
        </div>
        
        <!-- Mensaje √∫nico central -->
        <div class="message-container">
            <h1 id="unicoMensaje"></h1>
        </div>
        
        <!-- Galer√≠a de im√°genes -->
        <div id="imagenes" class="gallery"></div>
        
        <!-- Secci√≥n de audio -->
        <div class="audio-section">
            <button id="audioButton" class="audio-button" onclick="toggleAudio()">
                <span id="playIcon">‚ñ∂Ô∏è</span>
                <span id="audioButtonText">Iniciar m√∫sica</span>
            </button>
            <div class="song-info" id="songInfo"></div>
        </div>
        
        <!-- Footer -->
        <footer>
            <div id="firma"></div>
        </footer>
    </div>
    
    <!-- Elemento de audio oculto -->
    <audio id="backgroundMusic" loop>
        <!-- La fuente se establecer√° din√°micamente -->
    </audio>

    <script>
        // Fechas importantes
        const FECHA_INICIO = new Date('2024-08-22T20:00:00'); // 22 de agosto de 2024, 8:00 PM
        const FECHA_DISPONIBILIDAD = new Date('2026-02-14T00:00:00'); // 14 de febrero de 2026 (solo informativa)
        
        // Mensajes
        const mensajesUnicos = [
            "Aqu√≠ sigo. Sin ruido, con calma.",
            "No todo lo importante se dice.",
            "Simplemente aqu√≠. Sin exigencias.",
            "Contigo, en lo que no se nombra pero se siente.",
            "Presente. Estuve cuando no era f√°cil y sigo estando.",
            "Algunas cosas se sostienen estando."
        ];

        const firmas = [
            "Aqu√≠ sigo.",
            "Sin ruido, con calma.",
            "Presente.",
            "Contigo.",
            "Simplemente aqu√≠.",
            "Aqu√≠ permanezco."
        ];

        // Generar array de 96 fotos
        const fotos = Array.from({length: 96}, (_, i) => `fotos/foto${i + 1}.jpg`);
        
        // Lista de canciones POSIBLES
        const cancionesPosibles = [
            { archivo: 'musica/musica1.mp3', nombre: 'Aqu√≠ sigo' },
            { archivo: 'musica/musica2.mp3', nombre: 'Sin ruido' },
            { archivo: 'musica/musica3.mp3', nombre: 'Con calma' }
        ];

        // Canciones de respaldo en l√≠nea por si los archivos locales no existen
        const cancionesRespaldo = [
            { archivo: 'https://assets.mixkit.co/music/preview/mixkit-driving-ambition-32.mp3', nombre: 'M√∫sica alternativa' }
        ];

        // Variables globales
        let cancionesDisponibles = [];
        let musicaActual = null;
        let animacionTerminada = false;
        let autoplayBlocked = false;
        let countdownInterval = null;
        let elapsedInterval = null;
        let contenidoInicializado = false;

        // Funci√≥n para obtener un elemento aleatorio
        function getRandomElement(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        // Funci√≥n para seleccionar elementos aleatorios sin repetici√≥n
        function selectUniqueRandom(arr, count) {
            const shuffled = [...arr].sort(() => Math.random() - 0.5);
            return shuffled.slice(0, count);
        }

        // Funci√≥n para verificar qu√© archivos de m√∫sica existen realmente
        async function verificarArchivosMusica() {
            const cancionesValidas = [];
            
            for (const cancion of cancionesPosibles) {
                try {
                    const response = await fetch(cancion.archivo, { method: 'HEAD' });
                    if (response.ok) {
                        cancionesValidas.push(cancion);
                        console.log(`‚úÖ ${cancion.archivo} existe`);
                    } else {
                        console.log(`‚ùå ${cancion.archivo} no existe (${response.status})`);
                    }
                } catch (error) {
                    console.log(`‚ùå ${cancion.archivo} no se pudo cargar`);
                }
            }
            
            if (cancionesValidas.length === 0) {
                console.log("No se encontraron archivos de m√∫sica locales, usando respaldo en l√≠nea");
                return cancionesRespaldo;
            }
            
            return cancionesValidas;
        }

        // CRON√ìMETRO REGRESIVO (solo informativo)
        function iniciarCountdown() {
            function actualizarCountdown() {
                const ahora = new Date();
                const diferencia = FECHA_DISPONIBILIDAD - ahora;
                
                if (diferencia <= 0) {
                    document.getElementById('countdown-days').textContent = '00';
                    document.getElementById('countdown-hours').textContent = '00';
                    document.getElementById('countdown-minutes').textContent = '00';
                    document.getElementById('countdown-seconds').textContent = '00';
                    return;
                }
                
                const dias = Math.floor(diferencia / (1000 * 60 * 60 * 24));
                const horas = Math.floor((diferencia % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutos = Math.floor((diferencia % (1000 * 60 * 60)) / (1000 * 60));
                const segundos = Math.floor((diferencia % (1000 * 60)) / 1000);
                
                document.getElementById('countdown-days').textContent = dias.toString().padStart(2, '0');
                document.getElementById('countdown-hours').textContent = horas.toString().padStart(2, '0');
                document.getElementById('countdown-minutes').textContent = minutos.toString().padStart(2, '0');
                document.getElementById('countdown-seconds').textContent = segundos.toString().padStart(2, '0');
            }
            
            actualizarCountdown();
            countdownInterval = setInterval(actualizarCountdown, 1000);
        }

        // CRON√ìMETRO PROGRESIVO desde el 22 de agosto de 2024
        function iniciarTiempoTranscurrido() {
            function actualizarTiempoTranscurrido() {
                const ahora = new Date();
                const diferencia = ahora - FECHA_INICIO;
                
                const segundosTotales = Math.floor(diferencia / 1000);
                const minutosTotales = Math.floor(segundosTotales / 60);
                const horasTotales = Math.floor(minutosTotales / 60);
                const diasTotales = Math.floor(horasTotales / 24);
                
                const a√±os = Math.floor(diasTotales / 365.25);
                const diasRestantes = diasTotales - (a√±os * 365.25);
                
                const meses = Math.floor(diasRestantes / 30.44);
                const dias = Math.floor(diasRestantes - (meses * 30.44));
                
                const horas = horasTotales % 24;
                const minutos = minutosTotales % 60;
                const segundos = segundosTotales % 60;
                
                document.getElementById('elapsed-years').textContent = a√±os;
                document.getElementById('elapsed-months').textContent = meses;
                document.getElementById('elapsed-days').textContent = dias;
                document.getElementById('elapsed-hours').textContent = horas.toString().padStart(2, '0');
                document.getElementById('elapsed-minutes').textContent = minutos.toString().padStart(2, '0');
                document.getElementById('elapsed-seconds').textContent = segundos.toString().padStart(2, '0');
                
                const previewElement = document.getElementById('elapsed-preview');
                if (previewElement) {
                    previewElement.textContent = `${a√±os} a√±os, ${meses} meses, ${dias} d√≠as, ${horas} horas, ${minutos} minutos, ${segundos} segundos`;
                }
            }
            
            actualizarTiempoTranscurrido();
            elapsedInterval = setInterval(actualizarTiempoTranscurrido, 1000);
        }

        // Mostrar contenido principal (solo se llama si la clave es correcta)
        function mostrarContenido() {
            // Limpiar intervalos
            if (countdownInterval) clearInterval(countdownInterval);
            
            const loadingScreen = document.getElementById('loadingScreen');
            
            loadingScreen.style.opacity = '0';
            loadingScreen.style.transition = 'opacity 1s ease';
            
            setTimeout(() => {
                loadingScreen.style.display = 'none';
                setupAnimacion();
            }, 1000);
        }

        // Funci√≥n para acceder con clave
        function accederConClave() {
            const passwordInput = document.getElementById('passwordInput');
            const errorDiv = document.getElementById('passwordError');
            const clave = passwordInput.value.trim();
            
            if (clave === '2204') {
                errorDiv.textContent = ''; 
                mostrarContenido();
            } else {
                errorDiv.textContent = '‚ùå Clave incorrecta. Intenta de nuevo.';
                passwordInput.value = '';
                passwordInput.focus();
            }
        }

        // Configurar animaci√≥n de im√°genes a pantalla completa
        function setupAnimacion() {
            const animationContainer = document.getElementById('fullscreenAnimation');
            animationContainer.style.display = 'flex';
            
            const animationImages = selectUniqueRandom(fotos, 3);
            
            animationImages.forEach((imgSrc, index) => {
                const img = document.createElement('img');
                img.className = 'animation-image';
                img.src = imgSrc;
                img.alt = `Imagen ${index + 1}`;
                img.onerror = function() {
                    this.src = 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=800&auto=format&fit=crop';
                };
                animationContainer.appendChild(img);
            });
            
            setTimeout(() => {
                animationContainer.style.opacity = '0';
                animationContainer.style.transition = 'opacity 1s ease';
                
                setTimeout(() => {
                    animationContainer.style.display = 'none';
                    document.getElementById('mainContainer').style.display = 'block';
                    animacionTerminada = true;
                    
                    intentarReproducirMusica();
                }, 1000);
            }, 12000);
        }

        // Inicializar contenido (preparar m√∫sica, mensajes, galer√≠a)
        async function initContenido() {
            if (contenidoInicializado) return;
            
            cancionesDisponibles = await verificarArchivosMusica();
            
            if (cancionesDisponibles.length === 0) {
                console.error("No hay archivos de m√∫sica disponibles");
                return;
            }
            
            document.getElementById("unicoMensaje").textContent = getRandomElement(mensajesUnicos);
            document.getElementById("firma").textContent = getRandomElement(firmas);
            
            musicaActual = getRandomElement(cancionesDisponibles);
            const audioElement = document.getElementById('backgroundMusic');
            audioElement.src = musicaActual.archivo;
            
            setupGaleria();
            
            document.getElementById('songInfo').textContent = `üéµ ${musicaActual.nombre}`;
            contenidoInicializado = true;
        }

        async function intentarReproducirMusica() {
            const audioElement = document.getElementById('backgroundMusic');
            const songInfo = document.getElementById('songInfo');
            
            if (cancionesDisponibles.length === 0) {
                songInfo.textContent = 'No se encontraron archivos de m√∫sica.';
                songInfo.style.color = '#ff6b6b';
                document.querySelector('.audio-section').style.display = 'block';
                document.getElementById('audioButton').style.display = 'none';
                return;
            }
            
            try {
                await audioElement.play();
                console.log("M√∫sica iniciada autom√°ticamente al cargar:", musicaActual.nombre);
                songInfo.textContent = `üéµ ${musicaActual.nombre}`;
                songInfo.style.color = '';
            } catch (error) {
                console.log("Autoplay bloqueado por el navegador:", error);
                autoplayBlocked = true;
                document.querySelector('.audio-section').style.display = 'block';
                songInfo.textContent = 'La m√∫sica no pudo iniciar autom√°ticamente. Toca el bot√≥n para reproducir.';
                songInfo.style.color = '#ff6b6b';
            }
        }

        function setupGaleria() {
            const galleryContainer = document.getElementById('imagenes');
            galleryContainer.innerHTML = '';
            
            const galleryImages = selectUniqueRandom(fotos, 6);
            
            galleryImages.forEach((imgSrc, index) => {
                const frame = document.createElement('div');
                frame.className = 'photo-frame';
                frame.onclick = () => openFullscreen(imgSrc);
                
                const img = document.createElement('img');
                img.src = imgSrc;
                img.alt = `Imagen ${index + 1}`;
                img.loading = "lazy";
                img.onerror = function() {
                    this.parentElement.style.display = 'none';
                };
                
                frame.appendChild(img);
                galleryContainer.appendChild(frame);
            });
        }

        function toggleAudio() {
            const audioElement = document.getElementById('backgroundMusic');
            const audioButtonText = document.getElementById('audioButtonText');
            const playIcon = document.getElementById('playIcon');
            const songInfo = document.getElementById('songInfo');
            
            if (audioElement.paused) {
                audioElement.play().then(() => {
                    audioButtonText.textContent = 'Pausar m√∫sica';
                    playIcon.textContent = '‚è∏Ô∏è';
                    songInfo.textContent = `üéµ ${musicaActual.nombre}`;
                    songInfo.style.color = '';
                }).catch(error => {
                    console.error("Error al iniciar m√∫sica:", error);
                    songInfo.textContent = 'Error al reproducir la m√∫sica. Intenta de nuevo.';
                    songInfo.style.color = '#ff6b6b';
                });
            } else {
                audioElement.pause();
                audioButtonText.textContent = 'Reanudar m√∫sica';
                playIcon.textContent = '‚ñ∂Ô∏è';
            }
        }

        function openFullscreen(imgSrc) {
            const fullscreen = document.getElementById('imageFullscreen');
            const fullscreenImg = document.getElementById('fullscreenImg');
            fullscreenImg.src = imgSrc;
            fullscreen.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function closeFullscreen() {
            document.getElementById('imageFullscreen').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        function setupAudioHandlers() {
            const audioElement = document.getElementById('backgroundMusic');
            const songInfo = document.getElementById('songInfo');
            const audioSection = document.querySelector('.audio-section');
            
            audioElement.addEventListener('error', (e) => {
                console.error("Error cargando audio:", audioElement.error);
                
                if (cancionesDisponibles.length > 1) {
                    const currentIndex = cancionesDisponibles.findIndex(c => c.archivo === musicaActual.archivo);
                    if (currentIndex > -1) {
                        cancionesDisponibles.splice(currentIndex, 1);
                    }
                    
                    if (cancionesDisponibles.length > 0) {
                        musicaActual = getRandomElement(cancionesDisponibles);
                        audioElement.src = musicaActual.archivo;
                        audioElement.load();
                        songInfo.textContent = `Intentando: ${musicaActual.nombre}...`;
                        
                        setTimeout(() => {
                            audioElement.play().catch(err => {
                                songInfo.textContent = 'Toca el bot√≥n para reproducir.';
                                songInfo.style.color = '#ff6b6b';
                                audioSection.style.display = 'block';
                            });
                        }, 1000);
                        return;
                    }
                }
                
                songInfo.textContent = 'Error cargando la m√∫sica. Verifica los archivos en la carpeta "musica".';
                songInfo.style.color = '#ff6b6b';
                audioSection.style.display = 'block';
                document.getElementById('audioButton').style.display = 'none';
            });
            
            audioElement.addEventListener('play', () => {
                songInfo.textContent = `üéµ ${musicaActual.nombre}`;
                songInfo.style.color = '';
                if (autoplayBlocked) {
                    document.getElementById('audioButtonText').textContent = 'Pausar m√∫sica';
                    document.getElementById('playIcon').textContent = '‚è∏Ô∏è';
                }
            });
            
            audioElement.addEventListener('pause', () => {
                if (autoplayBlocked) {
                    document.getElementById('audioButtonText').textContent = 'Reanudar m√∫sica';
                    document.getElementById('playIcon').textContent = '‚ñ∂Ô∏è';
                }
            });
        }

        // Inicializaci√≥n al cargar la p√°gina
        window.addEventListener('load', async () => {
            iniciarTiempoTranscurrido();
            iniciarCountdown();
            
            // Preparar el contenido en segundo plano (no se muestra hasta la clave)
            await initContenido();
            setupAudioHandlers();
            
            // Eventos para el bot√≥n de clave
            document.getElementById('passwordButton').addEventListener('click', accederConClave);
            document.getElementById('passwordInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') accederConClave();
            });
            
            // Intentar autoplay cuando se pueda (solo despu√©s de mostrar contenido)
            // No hacemos nada aqu√≠, se maneja en mostrarContenido
        });

        // Cerrar fullscreen con tecla ESC
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeFullscreen();
        });

        document.getElementById('imageFullscreen').addEventListener('click', (e) => {
            if (e.target.id === 'imageFullscreen') closeFullscreen();
        });

        // Prevenir zoom no deseado en m√≥viles
        document.addEventListener('touchstart', (e) => {
            if (e.touches.length > 1) e.preventDefault();
        }, { passive: false });

        let lastTouchEnd = 0;
        document.addEventListener('touchend', (e) => {
            const now = Date.now();
            if (now - lastTouchEnd <= 300) e.preventDefault();
            lastTouchEnd = now;
        }, false);
    </script>
</body>
</html>
